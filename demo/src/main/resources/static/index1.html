<!DOCTYPE html>
<html>
<head>
    <title>Stock Entry Form</title>
</head>
<body>

<h1>STOCK ENTRY</h1>

<form id="productForm">

    <label for="productSelect">Product:</label>
    <select id="productSelect" name="productId" required>
        <option disabled selected>Loading...</option>
    </select>
    <br><br>

    <label for="stockOwner">Stock Owner:</label>
    <input type="text" id="stockOwner" name="stockOwner" required>
    <br><br>

    <button type="submit">Submit</button>
</form>

<script>
    window.onload = function () {
      fetch("/getAll")
        .then(response => {
          if (!response.ok) {
            throw new Error("HTTP Error " + response.status);
          }
          return response.json();
        })
        .then(products => {
          const dropdown = document.getElementById("productSelect");
          dropdown.innerHTML = '';

          products.forEach(product => {
            const option = document.createElement("option");
            option.value = product.id;
            option.text = `${product.id} - ${product.name}`;
            dropdown.appendChild(option);
          });
        })
        .catch(error => {
          console.error("Error loading product list", error);
          alert("Loading failed");
        });
    };

    document.getElementById("productForm").addEventListener("submit", function (event) {
      event.preventDefault();

      const selectedProductId = document.getElementById("productSelect").value;
      const stockOwner = document.getElementById("stockOwner").value;

      const stockData = {
        totalStock: parseInt(selectedProductId),
        stockOwner: stockOwner
      };

      fetch("/saveStock", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(stockData)
      })
        .then(response => {
          if (response.ok) {
            alert("Stock saved successfully");
            document.getElementById("productForm").reset();
          } else {
            alert("Failed to save stock");
          }
        })
        .catch(error => {
          console.error("Error saving stock", error);
          alert("Something went wrong");
        });
    });
</script>

</body>
</html>
